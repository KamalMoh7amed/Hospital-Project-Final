@{
    ViewData["Title"] = "تفاصيل المريض";
    var patient = ViewBag.Patient as Hospital_Project.Models.Patient;
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>👤 تفاصيل المريض: <span class="text-primary">@patient.PatientName</span></h2>
        <a asp-action="Index" class="btn btn-secondary">⬅️ العودة للوحة التحكم</a>
    </div>

    <!-- البيانات الأساسية -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5>📋 البيانات الأساسية</h5>
        </div>
        <div class="card-body">
            <p><strong>تاريخ الميلاد:</strong> @patient.DateOfBirth.ToString("yyyy-MM-dd")</p>
            <p><strong>الجنس:</strong> @(patient.Gender == 'M' ? "ذكر" : "أنثى")</p>
            <p><strong>الهاتف:</strong> @patient.Phone</p>
            <p><strong>البريد:</strong> @patient.Email</p>
            <p><strong>العنوان:</strong> @patient.Address</p>
        </div>
    </div>

    <!-- المواعيد -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5>📅 المواعيد (@ViewBag.Appointments?.Count)</h5>
        </div>
        <div class="card-body">
            @if (ViewBag.Appointments != null && ViewBag.Appointments.Count > 0)
            {
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>الوقت</th>
                                <th>الدكتور</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var a in ViewBag.Appointments as List<Hospital_Project.Models.Appointment>)
                            {
                                <tr>
                                    <td>@a.AppointmentDate</td>
                                    <td>@a.Time</td>
                                    <td>د. @a.Doctor?.DoctorName</td>
                                    <td>@a.AppointmentStatus</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-muted">لا يوجد مواعيد.</p>
            }
        </div>
    </div>

    <!-- السجلات الطبية والوصفات -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5>📋 السجلات الطبية (@ViewBag.MedicalRecords?.Count)</h5>
        </div>
        <div class="card-body">
            @if (ViewBag.MedicalRecords != null && ViewBag.MedicalRecords.Count > 0)
            {
                @foreach (var mr in ViewBag.MedicalRecords as List<Hospital_Project.Models.MedicalRecord>)
                {
                    <div class="border rounded p-3 mb-3">
                        <h6>د. @mr.Doctor?.DoctorName - @mr.Appointment?.AppointmentDate</h6>
                        <p><strong>التشخيص:</strong> @mr.Diagnosis</p>
                        <p><strong>الوصف:</strong> @mr.Description</p>

                        @if (mr.Prescription != null)
                        {
                            <div class="alert alert-info mt-2 p-2">
                                <strong>💊 الوصفة:</strong> @mr.Prescription.MedicationName<br />
                                <strong>الجرعة:</strong> @mr.Prescription.Dosage<br />
                                <strong>المدة:</strong> من @mr.Prescription.StartDate إلى @mr.Prescription.EndDate
                            </div>
                        }
                    </div>
                }
            }
            else
            {
                <p class="text-muted">لا يوجد سجلات طبية.</p>
            }
        </div>
    </div>

    <!-- المدفوعات -->
    <div class="card">
        <div class="card-header bg-light">
            <h5>💰 المدفوعات (@ViewBag.Payments?.Count)</h5>
        </div>
        <div class="card-body">
            @if (ViewBag.Payments != null && ViewBag.Payments.Count > 0)
            {
                <table class="table table-sm">
                    <thead>
                        <tr><th>المبلغ</th><th>التاريخ</th><th>الطريقة</th></tr>
                    </thead>
                    <tbody>
                        @foreach (var p in ViewBag.Payments as List<Hospital_Project.Models.Payments>)
                        {
                            <tr>
                                <td>@p.AmountPaid.ToString("C")</td>
                                <td>@p.PaymentDate</td>
                                <td>@p.PaymentMethod</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">لا يوجد مدفوعات.</p>
            }
        </div>
    </div>
</div>